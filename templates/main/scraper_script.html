(function(){const e=window.location.host;let t="unknown";e.includes("claude.ai")?t="claude":e.includes("openai.com")||e.includes("chatgpt.com")?t="chatgpt":e.includes("gemini.google.com")&&(t="gemini");if(t==="unknown"){alert("Claudex: Unsupported site. Use claude.ai, chatgpt.com, or gemini.google.com");return}function n(){const e=[];document.querySelectorAll('[data-testid="user-message"]').forEach(t=>{const n=t.querySelector("p.whitespace-pre-wrap")||t.querySelector("p")||t;const r=n?.textContent?.trim();r&&e.push({role:"user",content:r,order:t.getBoundingClientRect().top})});document.querySelectorAll('[data-is-streaming="false"] .font-claude-response, .font-claude-response').forEach(t=>{let n="";const r=t.querySelectorAll(".standard-markdown, .progressive-markdown");r.length>0?r.forEach(e=>{const t=e.textContent?.trim();t&&(n+=(n?"\n\n":"")+t)}):n=t.textContent?.trim()||"";n.length>10&&e.push({role:"assistant",content:n,order:t.getBoundingClientRect().top})});e.sort((e,t)=>e.order-t.order);return e.map(({role:e,content:t})=>({role:e,content:t}))}function r(){const e=[];const t=document.querySelectorAll("[data-message-author-role]");t.length>0?t.forEach(t=>{const n=t.getAttribute("data-message-author-role");const r=t.querySelector(".markdown")||t.querySelector(".prose")||t;let o=r?.textContent?.trim()||"";o=o.replace(/Copy code/g,"").trim();o.length>5&&e.push({role:n==="assistant"?"assistant":"user",content:o})}):document.querySelectorAll('[data-testid*="conversation-turn"]').forEach((t,n)=>{const r=t.textContent?.trim();r&&r.length>5&&e.push({role:n%2===0?"user":"assistant",content:r})});return e}function o(){const e=[];document.querySelectorAll("user-query").forEach(t=>{const n=t.querySelector(".query-text")||t.querySelector("p")||t;const r=n?.textContent?.trim();r&&e.push({role:"user",content:r,order:t.getBoundingClientRect().top})});document.querySelectorAll("model-response").forEach(t=>{const n=t.querySelector("message-content")||t.querySelector(".markdown")||t;const r=n?.textContent?.trim();r&&r.length>10&&e.push({role:"assistant",content:r,order:t.getBoundingClientRect().top})});e.sort((e,t)=>e.order-t.order);return e.map(({role:e,content:t})=>({role:e,content:t}))}let s;t==="claude"?s=n():t==="chatgpt"?s=r():t==="gemini"&&(s=o());if(!s||s.length===0){alert("Claudex: No messages found. Make sure you're on an active chat.");return}const a=[];let i=null,c=[];for(const e of s)e.role==="user"?(i&&c.length>0&&a.push({question:i,answer:c.join("\n\n")}),i=e.content,c=[]):e.role==="assistant"&&c.push(e.content);i&&c.length>0&&a.push({question:i,answer:c.join("\n\n")});const l=document.querySelector('button[data-testid="chat-menu-trigger"]')?.textContent?.trim()||document.querySelector("h1")?.textContent?.trim()||t+" Chat";const u={title:l,platform:t,exportDate:new Date().toISOString(),sessions:a};const d=JSON.stringify(u,null,2);navigator.clipboard.writeText(d).then(()=>{alert(`âœ… Claudex Export Done!\n\nPlatform: ${t}\nSessions: ${a.length}\n\nData copied to clipboard!\nPaste it into Claudex StudyMate.`)}).catch(()=>{console.log("=== COPY THIS JSON ===\n"+d+"\n=== END ===");alert(`Claudex: Found ${a.length} sessions.\nCouldn't copy automatically.\nCheck console for the JSON.`)})})();